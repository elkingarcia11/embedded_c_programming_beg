/**
  ******************************************************************************
  * @file    main.c
  * @author  Auto-generated by STM32CubeIDE
  * @version V1.0
  * @brief   Default main function.
  ******************************************************************************
*/

#if !defined(__SOFT_FP__) && defined(__ARM_FP)
  #warning "FPU is not initialized, but the project is compiling for an FPU. Please initialize the FPU before use."
#endif


/* Output pins: PD0,1,2,3
 * Input: PD11, 10, 9, 8
 * Data output register
 * data input register
 * data mode register
 * data pull up register
 * clock enable register
 *
 */

#include <stdio.h>
#include <stdint.h>


int main(void)
{

	// Base -> 0x40023800 Off set -> 0x30
	uint32_t volatile const* pClockReg = (uint32_t*)0x40023830;

	//0x40020C00 base - for 8 pins 8-11 and 0-3
	uint32_t volatile const*  gpiodModeReg = (uint32_t*)0x40020C00;

	// 0x10 offset - for pins 8-11
	uint32_t volatile const* gpiodInputDataReg = (uint32_t*)0x40020C10;

	// 0x14 offset - for pins 0-3
	uint32_t volatile const*  gpiodOutputDataReg = (uint32_t*)0x40020C14;

	// 0x0C offset
	uint32_t volatile const* gpiodPullUpReg = (uint32_t*)0x40020C0C;

	// Set gpiod clock t o1
	*pClockReg |= (1 << 3);
	// Clear 0-3 pin mode regs
	*gpiodModeReg &= ~0XFF;
	// Set up output mode of 0-3 pins
	*gpiodModeReg |= (0X55);

	// Set up input mode of pins 8-11 [clear them]
	*gpiodModeReg &= ~(0XFF << 16);

	// Set up pull up on pins 8-11. CLEAR then set
	*gpiodPullUpReg &= ~(0XFF << 16);
	*gpiodPullUpReg |= 0X55 << 16;//OX55

	while(1)
	{
		// Turn output data of pins 0-3 to high (1)
		*gpiodOutputDataReg |= 0X0F;
		// Turn 0th,1,2,3 output data pos to LOW,
		// Read all inputs - read if pins 8,9,10,11 are LOW as well
		// Print if true, otherwise move on

		//Clear pos i want
		*gpiodOutputDataReg &= ~1;

		// Check pins 8,9,10,11
		if(!(*gpiodInputDataReg & (1 << 8)))
		{
			printf("Key is 1");
			for(uint32_t i = 0; i < 300000; i++);
		} else if(!(*gpiodInputDataReg & (1 << 9)))
		{
			printf("Key is 2");
			for(uint32_t i = 0; i < 300000; i++);
		} else if(!(*gpiodInputDataReg & (1 << 10)))
		{
			printf("Key is 3");
			for(uint32_t i = 0; i < 300000; i++);
		} else if(!(*gpiodInputDataReg & (1 << 11)))
		{
			printf("Key is A");
			for(uint32_t i = 0; i < 300000; i++);
		}

		*gpiodOutputDataReg |= 1;

		*gpiodOutputDataReg &= ~(1 << 1);

		if(!(*gpiodInputDataReg & (1 << 8)))
		{
			printf("Key is 4");
			for(uint32_t i = 0; i < 300000; i++);
		} else if(!(*gpiodInputDataReg & (1 << 9)))
		{
			printf("Key is 5");
			for(uint32_t i = 0; i < 300000; i++);
		} else if(!(*gpiodInputDataReg & (1 << 10)))
		{
			printf("Key is 6");
			for(uint32_t i = 0; i < 300000; i++);
		} else if(!(*gpiodInputDataReg & (1 << 11)))
		{
			printf("Key is B");
			for(uint32_t i = 0; i < 300000; i++);
		}

		*gpiodOutputDataReg |= 1<<1;

		*gpiodOutputDataReg &= (~(1<<2));

		if(!(*gpiodInputDataReg & (1 << 8)))
		{
			printf("Key is 7");
			for(uint32_t i = 0; i < 300000; i++);
		} else if(!(*gpiodInputDataReg & (1 << 9)))
		{
			printf("Key is 8");
			for(uint32_t i = 0; i < 300000; i++);
		} else if(!(*gpiodInputDataReg & (1 << 10)))
		{
			printf("Key is 9");
			for(uint32_t i = 0; i < 300000; i++);
		} else if(!(*gpiodInputDataReg & (1 << 11)))
		{
			printf("Key is C");
			for(uint32_t i = 0; i < 300000; i++);
		}

		*gpiodOutputDataReg |= 1<<2;

		*gpiodOutputDataReg &= (~(1<<3));

		if(!(*gpiodInputDataReg & (1 << 8)))
		{
			printf("Key is *");
			for(uint32_t i = 0; i < 300000; i++);
		} else if(!(*gpiodInputDataReg & (1 << 9)))
		{
			printf("Key is 0");
			for(uint32_t i = 0; i < 300000; i++);
		} else if(!(*gpiodInputDataReg & (1 << 10)))
		{
			printf("Key is #");
			for(uint32_t i = 0; i < 300000; i++);
		} else if(!(*gpiodInputDataReg & (1 << 11)))
		{
			printf("Key is D");
			for(uint32_t i = 0; i < 300000; i++);
		}

		*gpiodOutputDataReg |= 1<<3;
	}


	for(;;);
}
